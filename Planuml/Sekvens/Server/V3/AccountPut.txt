frame AccountController - PUT

participant "AccountController" as controller
participant "AccountContext" as context
participant "AccountItem" as Item


==HttpPut(id)==


controller->context: PutAccountItem(id, accountItem)
activate context

opt id != accountItem.AccountId
context-->>controller: BadRequest()
deactivate context
end 
activate context
context->Item:_context.Entry(accountItem).State
activate Item


Item-->>context: Success
deactivate Item
alt Pass
context-->>controller: NoContent()
deactivate context
else Catch
alt if(!AccountItemExists(id)
activate context
context-->>controller: NotFound()
deactivate context
else 
activate context
context-->>controller: throw
deactivate context
deactivate controller
end 
end 

==HttpPut(id/balance)==

controller->context: PutAccountItemBalance(id, amount)
activate context
context->Item: AccountItems.FindAsync(id)
activate Item
Item-->>context: AccountItem
deactivate Item
opt if(accountItem==null)
context-->>controller: NotFound()
deactivate context
end 
activate context
opt if(accountItem.Balance + amount)<0)
context-->>controller: BadRequest()
deactivate context
end
activate context
context->Item: _context.Entry(accountItem).State
activate Item

Item-->>context: Status
deactivate Item
alt Pass
context-->>controller: NoContent()
deactivate context
else Catch
activate context
alt if (!AccountItemExists(id))
context-->>controller: NotFound()
deactivate context
else 
activate context
context-->>controller: throw
deactivate context
deactivate controller
end
end 
